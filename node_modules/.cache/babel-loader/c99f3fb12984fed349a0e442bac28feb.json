{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { logInsert } from \"./reportSlice\";\nexport const getBooks = createAsyncThunk(\"book/getBooks\", async (_, thunkAPI) => {\n  const {\n    rejectWithValue\n  } = thunkAPI;\n\n  try {\n    const res = await fetch(\"http://localhost:3005/books\");\n    const data = await res.json();\n    return data;\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\nexport const insertBook = createAsyncThunk('book/insertBook', async (bookData, thunkAPI) => {\n  const {\n    rejectWithValue,\n    getState,\n    dispatch\n  } = thunkAPI;\n\n  try {\n    bookData.userName = getState().auth.name; //disptch\n    // dispatch(deleteBook({ id: 5 }));\n\n    const res = await fetch('http://localhost:3005/books', {\n      method: 'POST',\n      body: JSON.stringify(bookData),\n      headers: {\n        'Content-type': 'application/json; charset=UTF-8'\n      }\n    }); //report\n\n    const data = await res.json();\n    dispatch(logInsert({\n      name: 'insertBook',\n      status: 'success'\n    }));\n    return data;\n  } catch (error) {\n    dispatch(logInsert({\n      name: 'insertBook',\n      status: 'failed'\n    }));\n    return rejectWithValue(error.message);\n  }\n});\nexport const deleteBook = createAsyncThunk('book/deleteBook', async (item, thunkAPI) => {\n  const {\n    rejectWithValue\n  } = thunkAPI;\n\n  try {\n    await fetch(`http://localhost:3005/books/${item.id}`, {\n      method: 'DELETE',\n      headers: {\n        'Content-type': 'application/json; charset=UTF-8'\n      }\n    });\n    return item;\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\nconst bookSlice = createSlice({\n  name: \"book\",\n  initialState: {\n    books: [],\n    isLoading: false,\n    error: null\n  },\n  //get book\n  extraReducers: {\n    [getBooks.pending]: (state, action) => {\n      state.error = null;\n      state.isLoading = true;\n    },\n    [getBooks.fulfilled]: (state, action) => {\n      state.isLoading = false;\n      state.books = action.payload;\n    },\n    [getBooks.rejected]: (state, action) => {\n      state.isLoading = false;\n      state.error = action.payload;\n    },\n    //insert book\n    [insertBook.pending]: (state, action) => {\n      state.isLoading = true;\n      state.error = null;\n    },\n    [insertBook.fulfilled]: (state, action) => {\n      state.isLoading = false;\n      state.books.push(action.payload);\n    },\n    [insertBook.rejected]: (state, action) => {\n      state.isLoading = false;\n      state.error = action.payload;\n    },\n    // delete book\n    [deleteBook.pending]: (state, action) => {\n      state.isLoading = true;\n      state.error = null;\n    },\n    [deleteBook.fulfilled]: (state, action) => {\n      state.isLoading = false;\n      state.books = state.books.filter(el => el.id !== action.payload.id);\n    },\n    [deleteBook.rejected]: (state, action) => {\n      state.isLoading = false;\n      state.error = action.payload;\n    }\n  }\n});\nexport default bookSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","logInsert","getBooks","_","thunkAPI","rejectWithValue","res","fetch","data","json","error","message","insertBook","bookData","getState","dispatch","userName","auth","name","method","body","JSON","stringify","headers","status","deleteBook","item","id","bookSlice","initialState","books","isLoading","extraReducers","pending","state","action","fulfilled","payload","rejected","push","filter","el","reducer"],"sources":["/Users/basharsamir/Documents/Project/react7/book-store/src/store/bookSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { logInsert } from \"./reportSlice\";\n\n\nexport const getBooks = createAsyncThunk(\n    \"book/getBooks\",\n    async (_, thunkAPI) => {\n        const { rejectWithValue } = thunkAPI;\n        try {\n        const res = await fetch(\"http://localhost:3005/books\");\n        const data = await res.json();\n        return data;\n        } catch (error) {\n        return rejectWithValue(error.message);\n        }\n    }\n);\nexport const insertBook = createAsyncThunk(\n    'book/insertBook',\n    async (bookData, thunkAPI) => {\n        const { rejectWithValue , getState , dispatch} = thunkAPI;\n        try {\n        bookData.userName = getState().auth.name;\n        //disptch\n        // dispatch(deleteBook({ id: 5 }));\n        const res = await fetch('http://localhost:3005/books', {\n            method: 'POST',\n            body: JSON.stringify(bookData),\n            headers: {\n            'Content-type': 'application/json; charset=UTF-8',\n        },\n        });\n        //report\n        const data = await res.json();\n        dispatch(logInsert({ name: 'insertBook', status: 'success' }));\n        return data;\n    } catch (error) {\n        dispatch(logInsert({ name: 'insertBook', status: 'failed' }));\n        return rejectWithValue(error.message);\n    }\n    }\n    \n);\nexport const deleteBook = createAsyncThunk(\n    'book/deleteBook',\n    async (item, thunkAPI) => {\n        const { rejectWithValue } = thunkAPI;\n        try {\n            await fetch(`http://localhost:3005/books/${item.id}`, {\n            method: 'DELETE',\n            headers: {\n                'Content-type': 'application/json; charset=UTF-8',\n            },\n            });\n    \n            return item;\n        } catch (error) {\n            return rejectWithValue(error.message);\n        }\n    }\n);\n\nconst bookSlice = createSlice({\n    name: \"book\",\n    initialState: { books: [], isLoading: false, error: null },\n    //get book\n    extraReducers: {\n    [getBooks.pending]: (state, action) => {\n        state.error = null;\n        state.isLoading = true;\n    },\n    [getBooks.fulfilled]: (state, action) => {\n        state.isLoading = false;\n        state.books = action.payload;\n    },\n    [getBooks.rejected]: (state, action) => {\n        state.isLoading = false;\n        state.error = action.payload;\n    },\n    //insert book\n    [insertBook.pending]: (state, action) => {\n        state.isLoading = true;\n        state.error = null;\n    },\n    [insertBook.fulfilled]: (state, action) => {\n        state.isLoading = false;\n        state.books.push(action.payload);\n    },\n    [insertBook.rejected]: (state, action) => {\n        state.isLoading = false;\n        state.error = action.payload;\n    },\n\n    // delete book\n    [deleteBook.pending]: (state, action) => {\n        state.isLoading = true;\n        state.error = null;\n    },\n    [deleteBook.fulfilled]: (state, action) => {\n        state.isLoading = false;\n        state.books = state.books.filter((el) => el.id !== action.payload.id);\n    },\n    [deleteBook.rejected]: (state, action) => {\n        state.isLoading = false;\n        state.error = action.payload;\n    },\n    },\n    \n    \n});\n\n\nexport default bookSlice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}